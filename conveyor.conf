include required("https://raw.githubusercontent.com/hydraulic-software/conveyor/master/configs/jvm/extract-native-libraries.conf")

app {
  fsname = console-whisperer-agent
  display-name = "Console Whisperer"
  rdns-name = "dev.nathanlively.console-whisperer-agent"

  version = ${env.APP_VERSION}
  vcs-url = "https://github.com/LiveNathan/console-whisperer-system"

  compression-level = high
  inputs += "target/*.jar"

  site {
  # Keep your base URL if needed for other purposes
  base-url = "https://livenathan.github.io/console-whisperer-deploy"
  
  # Add GitHub release configuration
  github {
    oauth-token = ${env.GITHUB_TOKEN}
    pages-branch = "gh-pages"  # Optional: if using GitHub Pages
  }
}

  jvm {
    feature-version = 25
    version = "25.0"

    linux.aarch64.glibc.inputs += "https://download.java.net/java/GA/jdk25/bd75d5f9689641da8e1daabeccb5528b/35/GPL/openjdk-25_linux-aarch64_bin.tar.gz"
    linux.amd64.glibc.inputs += "https://download.java.net/java/GA/jdk25/bd75d5f9689641da8e1daabeccb5528b/35/GPL/openjdk-25_linux-x64_bin.tar.gz"
    mac.aarch64.inputs += "https://download.java.net/java/GA/jdk25/bd75d5f9689641da8e1daabeccb5528b/35/GPL/openjdk-25_macos-aarch64_bin.tar.gz"
    mac.amd64.inputs += "https://download.java.net/java/GA/jdk25/bd75d5f9689641da8e1daabeccb5528b/35/GPL/openjdk-25_macos-x64_bin.tar.gz"
    windows.amd64.inputs += "https://download.java.net/java/GA/jdk25/bd75d5f9689641da8e1daabeccb5528b/35/GPL/openjdk-25_windows-x64_bin.zip"

    gui {
      main-class = "org.springframework.boot.loader.launch.JarLauncher"
      console = false
    }

    options += "-Xmx512m"

    system-properties {
      "server.port" = 0
      "spring.application.name" = "console-whisperer-agent"
      "logging.level.org.atmosphere" = "warn"
      "spring.mustache.check-template-location" = false
      "vaadin.launch-browser" = false
      "spring.threads.virtual.enabled" = true
      "cloud.server.url" = "wss://app.consolewhisperer.com/ws-agent"
      "cloud.server.auth.url" = "https://app.consolewhisperer.com"
      "logging.level.dev.nathanlively" = "debug"
      "spring.servlet.multipart.max-file-size" = "25MB"
      "server.shutdown" = "graceful"
      "spring.lifecycle.timeout-per-shutdown-phase" = "10s"
      "server.servlet.session.timeout" = "30m"
    }

    # Required --add-opens for Spring Boot 3.x with Java 25
    options += "--add-opens=java.base/java.lang=ALL-UNNAMED"
    options += "--add-opens=java.base/java.util=ALL-UNNAMED"
    options += "--add-opens=java.base/java.text=ALL-UNNAMED"
    options += "--add-opens=java.base/java.net=ALL-UNNAMED"
    options += "--add-opens=java.base/java.nio=ALL-UNNAMED"
    options += "--add-opens=java.base/java.lang.reflect=ALL-UNNAMED"
    options += "--add-opens=java.base/java.time=ALL-UNNAMED"
    options += "--add-opens=java.base/java.util.concurrent=ALL-UNNAMED"
    options += "--add-opens=java.management/sun.management=ALL-UNNAMED"

    modules = [
      jdk.zipfs
      java.management
      java.management.rmi
      java.naming
      java.sql
      java.security.jgss
      java.desktop
      java.instrument
      java.compiler
      jdk.unsupported
      java.logging
      java.prefs
      java.xml
      java.datatransfer
      java.security.sasl
      java.net.http
      java.scripting
      jdk.attach
      jdk.management
      jdk.crypto.ec
    ]
  }

  machines = [ "mac", "windows.amd64", "linux.amd64.glibc", "linux.aarch64.glibc" ]
}

conveyor.compatibility-level = 19
